# v0.26 更新说明

## 前言

因为本程序发布快一年，所以很多情况已经与之前不同，这里只会给出现在要使用这个程序的基础要求，细节不过多展开。

### 基础使用要求

#### 硬件

这里举例的是我的正常使用的硬件，只要高于这个应该是没有问题的：

* CPU：Intel Celeron J3455
* 内存：8G

#### 使用环境

群晖 DSM 7.0，Docker 部署，使用 Portainer 管理镜像，你的系统需要能够运行 Chrome。

#### 推荐的电影目录结构

见[文档](https://github.com/allanpk716/ChineseSubFinder/blob/docs/DesignFile/%E7%94%B5%E5%BD%B1%E7%9A%84%E6%8E%A8%E8%8D%90%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84.md)

#### 推荐的连续剧目录结构

见[文档](https://github.com/allanpk716/ChineseSubFinder/blob/docs/DesignFile/%E8%BF%9E%E7%BB%AD%E5%89%A7%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84%E8%A6%81%E6%B1%82.md)

### 部分暂时不打算修复的问题

* 部分嵌入式硬件和系统无法运行 Chrome 的，暂时不再支持 subhd 和 zimuku 的字幕下载。需等待共享字幕功能出现后，可能会开放给低性能设备使用。源头问题还是爬虫的问题，也是心智负担的问题，既然使用 go-rod ，我倾向于快速、通用的解决问题，而不是追求最少资源去完成目标任务。
* 程序启动后，点击“停止”没有反应。这个之前提过，由于前期偷懒，现在需要大量重构传入 context，个人觉得没必要花时间和精力解决这个问题。有些耗时任务停下来就是需要时间，特别是本地扫描和具体一个字幕去下载的时候，还有就是第一次的字幕命名格式自动修改（这个很耗时，别动，等操作）。现在是并发处理，本地我这里700+电影，90+连续剧，2 min 足够扫描完毕，除非你是非局域网（云盘）挂载的视频库，这个是跟网络质量强相关（我测试过使用 VPN 回家挂载视频库，扫描相同量，5min 起步）。
* 本程序扫描完毕会关闭 Chrome 进程，这个是浏览器无法正确释放的梗，go-rod 如果搞定了，就会取消这个功能，暂时是强制的，不打算给出设置接口。如果你是 Windows 使用，那么我的方案是，使用 Edge 看网页，Chrome 就不管了，这样就不会关闭你正在看的 Edge 。

## 更新点

* 新增，支持 http 和 socks5 代理。但是其实是本地开了 http 代理（19036端口）去中转，原因是 go-rod 只支持 http 代理（如果你是 Windows 使用，记得给防火墙权限，以及注意端口不要本占用）。
* 现在程序会获取本机的外网 IP。（用于本地的统计功能，不会发送这个隐私信息出去，有问题自行看代码。原因下面会提。）
* 每个字幕源现在可以设置每天的下载限制数量（不设置，反正超过也会下载不了，还会卡住等超时），这个下载数量限制是跟你的**外网IP**挂钩的，好处是，之前提过的，如果你给本程序前置配置一个动态代理，那么，如果你的 IP 池有 100个，假设，每天限制大概是 50 个字幕，那么你一天就能够下载 5000 个字幕，以此类推。注意，我这里默认是每天每个字幕源是 20 次的限制，具体是多少开始被字幕源限制，我没有测试，建议在 50 次以下。同时，下载的字幕都会被缓存，一年内都不会被删除，避免重复下载浪费下载次数。
* 从这个版本开始，会有大量的数据进行缓存，本地的视频信息、下载的字幕，以及之前的自动字幕时间轴校正的缓存。强烈**不建议**手动去删除 cache 目录下的任何内容，本程序有对应的自动清理计划。手动清理导致的问题，一般来说都是 Error 提示，不至于 Panic 程序崩溃。
* 新增，任务队列功能。所有的视频字幕下载任务都会放入一个队列（见[文档](https://github.com/allanpk716/ChineseSubFinder/tree/docs/DesignFile/%E4%BB%BB%E5%8A%A1%E9%98%9F%E5%88%97%E8%AE%BE%E8%AE%A1)），电影是可以做从最新到最老的排序下载的（连续剧没有做，太复杂，懒）。基于前面提到的，每天下载量有限，所以源头上就不可能一天把你的媒体库的所有视频下载完毕字幕，类似问题，请举一反三。 
* 现在会在本地建立已看视频字幕的缓存（开启 Emby 则生效），暂时还没有进行发送反馈，后续会给出手动开关，是否允许共享。
* 新增，支持使用 IMDB ID 去自动匹配 Emby 的视频路径。之前做的是手动映射，这个功能依然是能够使用的，但是易用性太差，所以还是加入了自动的功能，但是前提是你的视频必须被削刮过，没得 IMDB 信息，就没法用。如果新增的功能还是没能解决问题，那么我依然建议，使用手动的映射路径功能，这个肯定是能用且正确的，映射关系问题需要你自己去理清楚，物理机和 docker 的关系，以及 ChineseSubFinder 和 Emby 之间的路径关系。
* 新增，排除 “-trailer” 带有这个文件名的文件，这个是 TMM 削刮得到的预告片。见 #315
* 每个视频的下载任务会有独立的日志展示。请不要手动去删除日志文件夹的东西，主体日志7天回滚，单个视频任务的日志会跟随 TaskQueue 来管理。
