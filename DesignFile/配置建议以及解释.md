# 配置建议以及解释

## 配置建议

### Threads 

目前测试，设置到 6 ，群晖918+   8G 内存，是性能比较极限的数值。建议设置到 **2** 比较合适。太低就很慢，因为进行了大量的网络查询（依赖 IMDB API 以及各个字幕网站的查询接口）。太高的设置，这个看你的性能，也别太凶猛，不然被 ban IP。

### EveryTime

其实也无需经常扫描，按在下现在的使用情形举例。每天上午7点30群晖自动开机，然后本程序自动启动。设置 12h 的间隔，晚上回家吃完饭很可能电影剧集更新，正好观看。（后续考虑给出多个固定时间点的字幕扫描触发功能）

### SaveMultiSub

如果你担心本程序的自动选择最佳字幕的逻辑有问题（现在这个选择的逻辑写的很随意···），那么建议开启这个 SaveMultiSub: true。这样在视频的同级目录下会出现多个网站的 Top1 字幕。


### SubNameFormatter

如果你是  [Jellyfin](https://jellyfin.org/docs/general/server/media/subtitles.html)、[Plex](https://support.plex.tv/articles/200471133-adding-local-subtitles-to-your-media/) 或者其他媒体工具的用户，建议设置一下以下的设置信息，详细参考文档：[关于字幕名称命名格式说明](https://github.com/allanpk716/ChineseSubFinder/blob/docs/DesignFile/%E5%85%B3%E4%BA%8E%E5%AD%97%E5%B9%95%E5%90%8D%E7%A7%B0%E5%91%BD%E5%90%8D%E6%A0%BC%E5%BC%8F%E8%AF%B4%E6%98%8E.md)

```yaml
SubNameFormatter: 1 # 常规模式
```

> v0.14.x 开始有效

### RunAtStartup

默认这个值是 false。如果想要启动的时候马上开始扫描和下载，则需要设置为 true。见[讨论](https://github.com/allanpk716/ChineseSubFinder/issues/50)。

> v0.16.x 开始有效

## 精简配置

对于一般用户来说，这样的配置就足够了。如果需要更新的设置，见下一节。

```yaml
UseProxy: false
HttpProxy: http://127.0.0.1:10809
EveryTime: 6h
Threads: 2
RunAtStartup: true
MovieFolder: /media/电影
SeriesFolder: /media/连续剧
```

## 配置文件解析

```yaml
UseProxy: false
HttpProxy: http://127.0.0.1:10809
EveryTime: 6h
Threads: 4
SubTypePriority: 0
SubNameFormatter: 0
DebugMode: false
SaveMultiSub: false
SaveOneSeasonSub: false
RunAtStartup: true
CustomVideoExts: mpeg,flv,f4v # 这里是举例，一般来说这一项可以不填写（删除）足够满足大部分人的需求
MovieFolder: /media/电影
SeriesFolder: /media/连续剧
# 下面的设置非必须，可以删除不要
WhenSubSupplierInvalidWebHook: abc.com
```

* UseProxy，默认false。是否使用代理，需要配合 HttpProxy 设置

* HttpProxy，默认 http://127.0.0.1:10809 。http  代理这里不要留空，不适应就设置 UseProxy 为 false

* EveryTime，默认 6h。每隔多久触发一次下载逻辑。怎么用参考，[robfig/cron: a cron library for go](https://github.com/robfig/cron)

* Threads，并发数，最高到 20 个。看机器性能和网速来调整即可。

* SubTypePriority，字幕下载的优先级，0 是自动，1 是 srt 优先，2 是 ass/ssa 优先

* SubNameFormatter，字幕命名格式(默认不填写或者超出范围，则为 emby 格式)，0，emby 支持的的格式（AAA.chinese(简英,subhd).ass or AAA.chinese(简英,xunlei).default.ass），1常规格式（兼容性更好，AAA.zh.ass or AAA.zh.default.ass）

* DebugMode，默认 false。调试模式，会在每个视频的文件夹下，新建一个  subtmp 文件夹，把所有匹配到的字幕都缓存到这个目录，没啥事可以不开。开的话就可以让你手动选择一堆的字幕啦。

* SaveMultiSub，默认值 false。true 会在每个视频下面保存每个网站找到的最佳字幕（见《[如何手动刷新 emby 加载字幕](https://github.com/allanpk716/ChineseSubFinder/blob/docs/DesignFile/%E5%A6%82%E4%BD%95%E6%89%8B%E5%8A%A8%E5%88%B7%E6%96%B0%20Emby%20%E5%8A%A0%E8%BD%BD%E5%AD%97%E5%B9%95.md)》，会举例）。false ，那么每个视频下面就一个最优字幕。

* CustomVideoExts，默认值是空。v0.12.x 版本出现。自定义视频扩展名，多个扩展名用英文逗号分隔

* SaveOneSeasonSub，默认为 false。v0.12.x 版本出现。非必须的选项。true 的时候会在每一个连续剧下面保存 Sub_S01E0 这样的缓存文件夹，里面的内容是每一季的整季字幕包的缓存，便于人工核对。注意的是下载的是整季的字幕包才会出现在这，且整季的字幕包的命名要有 S01 这样的关键词才会下载。

* RunAtStartup，默认值是 false，启动容器/程序时，是否开始搜索并下载。v0.16.x 开始有效。

* MovieFolder，填写你的电影的目录

* SeriesFolder，填写你的连续剧的目录

* WhenSubSupplierInvalidWebHook，当字幕网站失效的时候，触发的 webhook 地址，xunlei、subhd、zimuku 解析故障的通知接口，给维护人员用，可以尽快去修复解析问题。一般人员**无需关心**此设置。默认使用的是 [bark](https://github.com/Finb/Bark) 的通知格式。

## 缓存数据库

在 v0.12.x 中引入了缓存数据库，相对于 config.yaml 来说，一般无需用户关心。在不同系统中会有不同的存储位置：

* Windows：在程序的目录下生成 settings.db（为了可以独立运行）
* Linux：/config/settings.db（为了适配 docker 镜像等原因）
